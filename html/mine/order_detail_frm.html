<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>我的订单</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/aui/aui_2_0.css" />
    <link rel="stylesheet" type="text/css" href="../../css/aui/aui_list_swipe.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/common/common.css" />
    <style>
    	body,html{
    		background:#F5F5F5;
    	}
    	.body-content{
    	   margin:0.5rem;
    	   background: #FFFFFF;
    	   height: auto;
    	   padding-bottom: 0.2rem;
    	   box-shadow:0px 1px 8px 0px rgba(64,134,254,0.1);
           border-radius:10px;
    	}
    	.shop_top{
    	   height: 6rem;
    	}
    	.mainImage{
           width:6rem;
           height:4.5rem;
           float:left;
           position:relative;
           margin:0.7rem;
           object-fit: content;
        }
        .shop_name{
            color: #333333;
            font-size: 1rem;
            font-weight: bold;
            padding-top: 1.5rem;
            max-width: 7rem;
        }
        .shop_number{
            color: #333333;
            font-weight: bold;
            font-size: 0.9rem;
            display: inline;
            position: relative;
            top: -1.4rem;
            right: 1rem;
            float: right;
        }
        .shop_price{
            color: #333333;
            font-weight:  bold;
            font-size: 0.8rem;
            position: relative;
            top: 0.5rem;
        }
        .line{
            height: 0.5rem;
            background: #F5F5F5;
            width: 100%;
            margin-top: 3rem;
        }
        .input_title{
            margin-left: 0.7rem;
            font-size: 0.8rem;
            color: #333333;
            /*float: left;*/
            margin-top: 1rem;
            font-weight:400;
            /*display: inline-block;*/
        }
        .input_val{
            text-align: right;
            font-size: 0.8rem;
            color: #333333;
            font-weight:400;
            height: auto;
        }
        .aui-list:before,.aui-list:after,.aui-list .aui-list-item:after{
            height: 0;
        }
        #addressType{
            margin-top: -1rem;
        }
        .aui-list textarea{
            margin:0!important;
            padding-top: 0.15rem;
            max-height: 3rem;
            height: auto;
        }
        #expreeNumber{
            margin-top: -1rem;
        }
        .icon_bottom{
           width: 0.7rem!important;
           margin: auto; 
       }
       .logistics_list{
            border-radius: 0px!important;
            border-top:solid 1px #F5F5F5;
            margin-top: 0.3rem;
            padding-left: 0.75rem;
       }
       .copy_img,.delivery_road,.delivery_begins{
            width: 1rem!important;
            display: inline!important;
            vertical-align: middle;
            z-index: 99;
        }
        .delivery_road{
            margin-left: -0.3rem;
            margin-right: 0.2rem
        }
        .delivery_begins{
            width: 1.5rem!important;
            margin-left: -0.5rem;
        }
    </style>
</head>
<body>
	<div class="body-content">
	   <div class="shop_top">
	       <div class="aui-list-item-media">
                <img src="../../icon/default/icon_default_big_pic.png" alt=""  class="mainImage" id="image"/>
            </div>
            <div class="shop_name aui-ellipsis-1" id="name">
                             <!--精品方向盘套（积分+钱）-->
            </div>
            <div class="shop_number" id="number">
              <!--x1-->
            </div>
            <div class="shop_price" id="price">
              <!--88积分+1元-->
            </div>
            
	   </div>
	   <div class="shop_body">
	       <!--<div class="input_title">
                商品合计
            </div>
            <div class="input_val" id="total_price">
                
            </div>-->
            <!--<div class="input_title">
                积分扣除
            </div>
            <div class="input_val" id="totle_integral">
                
            </div>
            <div class="input_title">
                兑换时间
            </div>
            <div class="input_val" id="insertDt">
                
            </div>-->
            <!--<div class="input_title">
                领取方式
            </div>
            <div class="input_val" id="pickupWay">
                
            </div>
            <div class="input_title">
                地址
            </div>
            <input class="input_val" style="max-width: 10rem;" id="address"/>-->
               <!--浙江省绍兴市上虞区福园506-->
            <!--</div>-->
             <div class="aui-content">
                    <ul class="aui-list aui-form-list">
                    <li class="aui-list-item">
                            <div class="aui-list-item-inner">
                                <div class="aui-list-item-label input_title">
                                    商品合计
                                </div>
                                <div class="aui-list-item-input">
                                    <input type="text" id="total_price" class="input_val" readonly>
                                </div>
                            </div>
                        </li>
                        <li class="aui-list-item">
                            <div class="aui-list-item-inner">
                                <div class="aui-list-item-label input_title">
                                    积分扣除
                                </div>
                                <div class="aui-list-item-input">
                                    <input type="text" id="totle_integral" class="input_val" readonly>
                                </div>
                            </div>
                        </li>
                        <li class="aui-list-item">
                            <div class="aui-list-item-inner">
                                <div class="aui-list-item-label input_title">
                                    兑换时间
                                </div>
                                <div class="aui-list-item-input">
                                    <input type="text" id="insertDt" class="input_val" readonly>
                                </div>
                            </div>
                        </li>
                        <li class="aui-list-item" style="margin-bottom: 0.5rem;">
                            <div class="aui-list-item-inner">
                                <div class="aui-list-item-label input_title">
                                     领取方式
                                </div>
                                <div class="aui-list-item-input">
                                    <input type="text" id="pickupWay" class="input_val" readonly>
                                </div>
                            </div>
                        </li>
                       
                        <li class="aui-list-item">
                            <div class="aui-list-item-inner">
                                <div class="aui-list-item-label input_title" id="addressType">
                                    地址
                                </div>
                                <div class="aui-list-item-input">
                                    <textarea  id="address" class="input_val" style="overflow: hidden;" readonly></textarea>
                                    <!--<input value="浙江省绍兴市上虞区复原三栋七单元506" class="input_val" style="word-wrap: break-word; word-break: normal;"/>-->
                                </div>
                            </div>
                        </li>
                        <li class="aui-list-item aui-hide" id="expreeNumber_type">
                            <div class="aui-list-item-inner">
                                <div class="aui-list-item-label input_title" style="margin-top: -1rem;">
                                    快递单号
                                </div>
                                <div class="aui-list-item-input">
                                    <input type="text" id="expreeNumber" class="input_val" readonly>
                                    <!--<input value="浙江省绍兴市上虞区复原三栋七单元506" class="input_val" style="word-wrap: break-word; word-break: normal;"/>-->
                                </div>
                            </div>
                        </li>
                    </ul>
                    <div id="logistics_list"></div>
                    
                </div>
                </div>  
	</div>
	<script type="text/template" charset="utf-8" id='logistics_list_src'>
            <div class="aui-list-item-text shop_expree_number" >
                           
                           <div class="aui-card-list logistics_list" style="">
                            
                            <div class="aui-card-list-content">
                                <ul class="aui-list aui-media-list">
                                {{ if(it.express.result.list.length > 0){}}
                                     {{ for(var n=0;n<1;n++){ }}
                                        
                                        <li class="aui-list-item aui-list-item-middle" style="border:none;box-shadow: unset;padding-left: 0rem;margin-bottom: 0rem;">
                                        <div class="aui-media-list-item-inner">
                                            <div class="aui-list-item-media">
                                                <div class="aui-list-item-text">
                                                    <div class="aui-list-item-title aui-font-size-12" style="text-align: center">
                                                        {{=it.express.result.list[n].time}}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="aui-list-item-inner" style="padding-top: 0.5rem!important;">
                                                <div class="aui-list-item-text" style="float: left;">
                                                    <img src="../../icon/common/icon_delivery_begins.png" class="delivery_begins"/>
                                                    <span style="margin-left: 0.5rem;">{{=it.express.result.list[n].status}}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                     
                                    {{ } }}
                                    <ul id="list" class="aui-hide"> 
                                    {{ for(var n=1;n<it.express.result.list.length;n++){ }}
                                        
                                        <li class="aui-list-item aui-list-item-middle" style="border:none;box-shadow: unset;padding-left: 0rem;margin-bottom: 0rem;">
                                        <div class="aui-media-list-item-inner">
                                            <div class="aui-list-item-media">
                                                <div class="aui-list-item-text">
                                                    <div class="aui-list-item-title aui-font-size-12" style="text-align: center">
                                                        {{=it.express.result.list[n].time}}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="aui-list-item-inner" style="padding-top: 0.5rem!important;">
                                                <div class="aui-list-item-text" style="float: left;">
                                                    <img src="../../icon/common/icon_delivery_road.png" class="delivery_road"/>
                                                    <span style="margin-left: 0.5rem;">{{=it.express.result.list[n].status}}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                     
                                    {{ } }}
                                     </ul>
                                    
                                    <img src="../../icon/common/icon_bottom.png" class="icon_bottom" onclick="icon_bottom()" id="icon_bottom"/> 
                                </ul>
                            </div>
                          
                        </div>                  
                          
                      {{ } }}
                     </div>

    </script>
	
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/jquery_3_2_1_min.js"></script>
<script type="text/javascript" src="../../script/doT_min.js"></script>
<script type="text/javascript" src="../../script/common/common.js"></script>
<script type="text/javascript">
	var cache;
	apiready = function(){
		cache = api.pageParam;
		console.log(JSON.stringify(cache));
		if(cache.data.expreeNumber == "" || cache.data.expreeNumber == null || cache.data.expreeNumber == undefined){
           
        }else{
          init_express();
            
        }
		init();
		api.parseTapmode();
	}
	function init(){		
		url = "api/integral-order/get-integral-order-by-id";
		params = {
			id:cache.data.id,
		}	
		console.log(JSON.stringify(params));
			ajax_Request(url, 'get', 'json', params, function(ret,err){
				log('订单详情',ret);
				if (ret) {
					if (ret.code == 0) {
						$("#name").html(ret.integralOrderByIdRecord.name);
						$("#number").html("x"+ret.integralOrderByIdRecord.quantity);
						if(ret.integralOrderByIdRecord.price != "0" && ret.integralOrderByIdRecord.integral == "0"){
						  $("#price").html(ret.integralOrderByIdRecord.price+"元");
						}else if(ret.integralOrderByIdRecord.price == "0" && ret.integralOrderByIdRecord.integral != "0"){
						  $("#price").html(ret.integralOrderByIdRecord.integral+"积分");
						}else {
						  $("#price").html(ret.integralOrderByIdRecord.integral+"积分+"+ret.integralOrderByIdRecord.price+"元");
						}
						$("#insertDt").val(ret.integralOrderByIdRecord.insertDt);
						if(ret.integralOrderByIdRecord.pickupWay == "0"){
						  $("#pickupWay").val("自提");
						  $("#addressType").html("自提地址");
						}else{
						  $("#pickupWay").val("邮寄");
						  $("#addressType").html("邮寄地址");
						}
						$("#address").val(ret.integralOrderByIdRecord.address);
						$("#image").attr("src",file_load_url+ret.integralOrderByIdRecord.image);
						$("#total_price").val("￥"+ret.integralOrderByIdRecord.orderAmount);
						$("#totle_integral").val(ret.integralOrderByIdRecord.totleIntegral);
						
						api.parseTapmode();
					} else {
	        			alert_msg(ret.msg);
		        	}
		        } else {
					alert_msg('服务器繁忙，请稍候再试！');
				}
	        })
		}

        function init_express(){
            defaultload("物流加载中");
            url = "/api/integral-order/aliyun-express-query";
            params = {
                id: cache.data.id,
                expreeNumber: cache.data.expreeNumber
            }   
            console.log(JSON.stringify(params));
                ajax_Request(url, 'get', 'json', params, function(ret,err){
                    log('物流详情',ret);
                    if (ret) {
                        if (ret.code == 0) {
                            if(JSON.stringify(ret.integralOrderByIdRecord) !=  '{}'){
                                var result = ret.integralOrderByIdRecord.express.result;
                                $("#expreeNumber").val(result.typename+"："+result.number);
                                $("#expreeNumber_type").removeClass("aui-hide"); 
                                var logistics_list_src = $('#logistics_list_src').html();
                                $('#logistics_list').html(doT.template( logistics_list_src )(ret.integralOrderByIdRecord));
                                api.parseTapmode();
                                api.hideProgress();
                               }else{
                                api.hideProgress();
                                alert_msg("暂无物流信息")
                               }
                        } else {
                            alert_msg(ret.msg);
                            api.hideProgress();
                        }
                    } else {
                        alert_msg('服务器繁忙，请稍候再试！');
                        api.hideProgress();
                    }
                })
            
        }
	   
	   //展开
	   function icon_bottom(){
            $("#list").removeClass("aui-hide");
            $("#icon_bottom").attr("src","../../icon/common/icon_top.png");
            $("#icon_bottom").attr("onclick","icon_top()");
        }
        //收回
        function icon_top(){
            $("#list").addClass("aui-hide");
            $("#icon_bottom").attr("src","../../icon/common/icon_bottom.png");
            $("#icon_bottom").attr("onclick","icon_bottom()");
        
        }
</script>
</html>