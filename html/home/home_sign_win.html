<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>驾校报名 /医院体检</title>
		<link rel="stylesheet" type="text/css" href="../../css/api.css" />
		<link rel="stylesheet" type="text/css" href="../../css/aui/aui_2_0.css" />
		<link rel="stylesheet" type="text/css" href="../../css/common/common.css" />
		<style>
			html,body{
    	}
    	header img {
		    width: 20px;
		}
		#menu{
			font-size:0.8rem;
		}
		#menuPackage{
			position: relative;
			background-color: #3F86FF;
			/*background: linear-gradient(to left, #03B4F7 , #90DBF7) !important;*/
		}
		.select{
	    	height: 2.5rem;
		    line-height: 2.5rem;
		    /* text-align: right; */
		    position: relative;
		    background: linear-gradient(to left, #03B4F7 , #90DBF7);
	    }
	    .select_kuang{
	    	width: 3rem;
		    position: absolute;
		    right: 0.5rem;
		    text-align: right;
		    font-size: 0.8rem;
	    }
	    .active{
	    	color: #3F86FF;
    		/* border-bottom: solid 2px; */
	    }
	    .order li{
            float: left;
		    font-size: 0.7rem;
		    margin-left: 2.2rem;
	    }
	    .order{
		    height: 2rem;
		    line-height: 2rem;
		    position: relative;
	        background: #FFFFFF;
		}
	    .order img{
		    width: 0.4rem;
   			margin-bottom: 1px;
   			-webkit-transition: 0.3s ease;
		}
		.screen{
		    float: right !important;
   			margin-right: 0.8rem;
		}
		.screen img{
			width: 0.8rem;
    		margin-bottom: -0.05rem;
		}
		.fenge{
			margin-left: 0rem !important;
		    width: 23%;
		    text-align: center;
		}
		.grad{
    		background: linear-gradient(to left, #03B4F7 , #90DBF7) !important;
    	}
    	.aui-searchbar-cancel img{
    		width:1.1rem;
    		margin-top: 0.25rem;
    	}
    	.messageNum{
		    width: 0.9rem;
		    height: 0.9rem;
		    background: #FF9138;
		    border-radius: 100%;
		    color: #FFF;
		    position: absolute;
		    right: 0.2rem;
		    top: 0.3rem;
		    line-height: 0.9rem;
		    font-size: 0.6rem;
    	}
    	.location{
		    width: 5rem !important;
   			margin-right: 0rem !important;
		}
		.location-img{
		    width: 0.8rem !important;
	        margin-bottom: -0.15rem;
	        margin-right: 0.2rem;
		}
		.location span{
			color:#5F676B;
			font-size:0.8rem;
		}
		.location-arrow{
			width: 0.5rem !important;
		    margin-bottom: -0.2rem !important;
    		margin-left: 0.2rem !important;
		}
		.blue-b{
			background: linear-gradient(to left, #03B4F7 , #90DBF7) !important;
			color:#FFFFFF;
		}

		#aui-header {
			color: #fff;
			background-color: #3F86FF!important;
		}

		.list_bar .list_bar_inner {
			background-color: #3F86FF;
		}

		.aui-bar-btn-item.aui-active {
			color: #3F86FF!important;
		}
		
		.mask{
			position: fixed;
			width: 100%;
			height: 100%;
			background: rgba(0,0,0,0.5);
			top: 2.25rem;
			z-index: 999;
		}
		.aui-pull-right-cancle{
			padding: 0 0.3rem;
		}
		
		.aui-searchbar {
		    display: -webkit-box;
		    -webkit-box-pack: center;
		    -webkit-box-align: center;
		    height: 2.5rem;
		    overflow: hidden;
		    width: 89%;
		    background-color: #3F86FF;
		    color: #9e9e9e;
		    -webkit-backface-visibility: hidden;
		    backface-visibility: hidden;
		    position: relative;
		}
		.aui-searchbar-cancel{
		    margin-right: 0.4rem;
		    color: #03B4F7;
		    font-size:0.8rem;
		}
		.aui-bar-nav {
		    top: 0;
		    line-height: 2.25rem;
		    color: #ffffff;
		    display: -webkit-inline-box;
		}
		.aui-searchbar-input {
		    margin: 0 0.5rem;
		    background-color: #ffffff;
		    border-radius: 25px;
		    height: 1.5rem;
		    line-height: 1.5rem;
		    font-size: 0.7rem;
		    position: relative;
		    padding-left: 1.3rem;
		    display: -webkit-box;
		    -webkit-box-flex: 1;
		    border: solid 1px #F1F1F1;
		}
		.aui-searchbar-input input {
		    color: #666666;
		    width: 100%;
		    padding: 0 1.5rem 0 0.5rem;
		    margin: 0;
		    height: 1.5rem;
		    line-height: normal;
		    border: 0;
		    -webkit-appearance: none;
		    font-size: 0.7rem;
		}
		.ser{
		    width: 15px;
		    position: absolute;
		    top: 0.4rem;
		    left: 0.4rem;
			color: #666666 !important;
		}
		.img_delete{
		    width: 0.7rem;
		    height: 0.7rem;
		    position: absolute;
		    top: 0.5rem;
		    right: 0.3rem;
		    display:none;
		}
    </style>
	</head>
	<body>
		<div id="menuPackage">
			<header class="aui-bar aui-bar-nav aui-border-b tab1 none-bottom-style" id="aui-header">
				<a class="aui-pull-left aui-btn" tapmode onclick="closeWin();">
					<img src="../../icon/common/icon_header_return_white.png">
				</a>
				<!-- <div class="aui-title" id="common_title">
		    	驾校报名/医院体检
		    </div> -->
				<!-- <div class="aui-title" id="common_title_input">
				<input type="text" name="" id="aui-title-input" class="aui-title-input" placeholder="搜索驾校/教练/医院" value="" />
			</div>
		    <a class="aui-pull-right aui-btn">
				<span class="aui-pull-right-confirm" tapmode onclick="showSearch()">搜索</span>
		    </a> -->
				<div class="aui-searchbar" id="search" style="overflow: visible">
					<div class="aui-searchbar-input aui-border-radius" style="overflow: visible">
						<form action="javascript:showSearch();" id="search-form">
							<img src="../../icon/home/search.png" alt="" class="ser" />
							<input type="search" id="search-input" placeholder="搜索驾校/医院">
							<img src="../../icon/common/icon_delete.png" alt="" class="img_delete" />
						</form>
					</div>
					<div class="aui-searchbar-cancel" tapmode onclick="showSearch()">搜索</div>
				</div>
			</header>
			<div class="aui-bar aui-bar-btn aui-bar-btn-full" id="menu">
				<div class="aui-bar-btn-item aui-active">驾校报名</div>
				<div class="aui-bar-btn-item">体检信息采集</div>
				<!-- <div class="aui-bar-btn-item">教练</div> -->
			</div>
			<div class="list_bar" id="slideSpan">
				<div class="list_bar_inner"></div>
			</div>
		</div>
		<!-- 驾校排序 -->
		<div class="order" id="driver_order">
			<ul>
				<li class="fenge active" tapmode onclick="driverSchoolSort(this,0)">
					<span>推荐</span>
				</li>
				<li class='fenge' tapmode onclick="driverSchoolSort(this,2)">
					<span>距离</span>
					<img src="../../icon/home/gray_arrow_top.png" alt="" class='arrow' />
				</li>
				<li class='fenge' tapmode onclick="driverSchoolSort(this,1)">
					<span>价格</span>
					<img src="../../icon/home/gray_arrow_top.png" alt="" class='arrow' />
				</li>
				<li tapmode onclick="openScreen('sign-up-action')" class="screen">
					<img src="../../icon/common/icon_select.png" alt="" />
					<span>筛选</span>
				</li>
			</ul>
		</div>
		<!-- 医院排序 -->
		<div class="order aui-hide">
			<ul>
				<li class="fenge active" tapmode onclick="hospitalSort(this,0)">
					<span>推荐</span>
				</li>
				<li class='fenge' tapmode onclick="hospitalSort(this,2)">
					<span>距离</span>
					<img src="../../icon/home/gray_arrow_top.png" alt="" class='arrow' />
				</li>
				<li class='fenge' tapmode onclick="hospitalSort(this,1)">
					<span>价格</span>
					<img src="../../icon/home/gray_arrow_top.png" alt="" class='arrow' />
				</li>
				<li tapmode onclick="openScreen('phyical-exam-action')" class="screen">
					<img src="../../icon/common/icon_select.png" alt="" />
					<span>筛选</span>
				</li>
			</ul>
		</div>
		<!-- 教练排序 -->
		<!-- <div class="order" id="coach_order">
			<ul>
				<li class='fenge active' tapmode onclick="drivingCoachSort(this,2)">
					<span>距离</span>
					<img src="../../icon/home/blue_arrow_top.png" alt="" class='arrow' />
				</li>

				<li tapmode onclick="openCoachScreen()" class="screen">
					<img src="../../icon/common/icon_select.png" alt="" />
					<span>筛选</span>
				</li>
			</ul>
		</div> -->
	</body>
	<script type="text/javascript" src="../../script/api.js"></script>
	<script type="text/javascript" src="../../script/aui/aui_tab.js"></script>
	<script type="text/javascript" src="../../script/jquery_3_2_1_min.js"></script>
	<script type="text/javascript" src="../../script/common/common.js"></script>
	<script type="text/javascript">
		var menuHeight; //menu高度
		var clearance = 70; //间隙
		var target_index = 0; //menu标记
		var cache;
		var yu_height; //沉浸部分的高度
		var pageParam = {}; //教练筛选条件
		var driveCityCode,driveCityName,hospitalCityCode,hospitalCityName;
		apiready = function() {
			cache = api.pageParam.data;
			var or_menu_height = $api.byId('menuPackage').offsetHeight;
			$api.fixStatusBar($api.byId('menuPackage'));
			//计算得到沉浸部分的高度
			yu_height = $api.byId('menuPackage').offsetHeight - or_menu_height;
			menuHeight = $api.byId('menuPackage').offsetHeight + $api.byId('driver_order').offsetHeight;
			openFrameGroup();
			toEventListener('coach', function(ret) {
				//			page=1;
				//			refresh = true;
				log('retss', ret);
				pageParam.carArr = ret.value.carArr;
				pageParam.arr = ret.value.arr;
			})
			//切换menu初始化
			var tabwork = new auiTab({
				element: document.getElementById("menu"),
				repeatClick: true
			}, function(ret) {
				if (ret) {
					f_slide($(ret.dom));
					setViewFrame(ret.index - 1);
					$('#search-input').val('');
					keyWords = "";
					$('input').blur();
					$(".img_delete").css("display", "none");
					if(ret.index == 1){
						sendEvent('screenCode',{cityCode:driveCityCode,cityName:driveCityName})
					}else if(ret.index == 2){
						sendEvent('screenCode',{cityCode:hospitalCityCode,cityName:hospitalCityName})
					}
					
					if ((ret.index == 1 && driverSchoolSelect[2] == 1) || (ret.index == 2 && hospitalSelect[2] == 1) || (ret.index == 3 && drivingCoachSelect[2] == 1)) {
						showSearch()
					} else {
						if (ret.index == 2) {
							hospitalSelect[2] = 1;
						} else if (ret.index == 3) {
							drivingCoachSelect[2] = 1;
						}
					}
				}
			});
			
			toEventListener('sign-up-action', function (ret) {
			    driveCityCode = ret.value.cityCode;
			    driveCityName = ret.value.cityName;
			})
			
			toEventListener('phyical-exam-action', function(ret) {
				hospitalCityCode = ret.value.cityCode;
				hospitalCityName = ret.value.cityName;
			})
			
			//给选中的menu添加样式
			$('.order').eq(cache.index).removeClass('aui-hide');
			f_slide($(".aui-bar-btn-item").eq(cache.index));
		};

		//滑块加载事件
		function f_slide(e) {
			$('.aui-bar-btn-item').removeClass('aui-active');
			$(e).addClass('aui-active');
			$('.list_bar').css('width', ($('.aui-active').width() - clearance * 2) + 'px');
			$('.list_bar_inner').css('width', ($('.aui-active').width() - clearance * 2 - 20) + 'px');
			document.getElementById('slideSpan').style.webkitTransform = 'translateX(' + ($(e).position().left + clearance) +
				'px)';
		}

		//设置frameGroup可见frame
		function setViewFrame(index) {
			target_index = index;
			$('.order').addClass('aui-hide');
			$('.order').eq(index).removeClass('aui-hide');
			api.setFrameGroupAttr({
				name: 'home_group',
				rect: {
					x: 0,
					y: menuHeight,
					w: 'auto',
					h: api.winHeight - menuHeight
				}
			});
			api.setFrameGroupIndex({
				name: 'home_group',
				index: index
			});
		}

		//加载home的group
		// , {
		// 	name: 'drivingCoach', //教练
		// 	bounces: true,
		// 	url: './driving_coach/home_index_driving_coach.html',
		// 	bgColor: '#EFEFF4',
		// 	scrollToTop: true
		// }
		function openFrameGroup() {
			menuHeight = $api.byId('menuPackage').offsetHeight + $api.dom('.order').offsetHeight;
			api.openFrameGroup({
				name: 'home_group',
				scrollEnabled: false,
				preload: 2,
				index: cache.index,
				rect: {
					x: 0,
					y: menuHeight,
					w: 'auto',
					h: api.winHeight - menuHeight
				},
				frames: [{
					name: 'signUp', //报名
					url: './home_index_signUp.html',
					bgColor: '#EFEFF4',
					bounces: true,
					scrollToTop: true
				}, {
					name: 'physicalExamination', //体检
					bounces: true,
					url: './home_index_physical_examination.html',
					bgColor: '#EFEFF4',
					scrollToTop: true
				}]
			}, function(ret, err) {
				var index = ret.index;
				setViewFrame(index);
			});

			/*api.openFrame({
				name: 'coach_search_detail',
				url: './driving_coach/coach_search_detail.html',
				bgColor: 'rgba(0,0,0,0.3)',
				rect: {
					x: 0,
					y: -api.winHeight,
					w: 'auto',
					h: api.winHeight
				},
				bounces: false,
				pageParam: pageParam,
				reload: true,
				softInputBarEnabled: true,
				softInputMode: 'resize'
			});*/
		}
		//驾校排序
		var driverSchoolArray = [1, 1, 1];
		var driverSchoolSelect = [0, 1, 1];

		function driverSchoolSort(it, i) {
			$(it).parent().find('li').each(function(index, e) {
				if ($(e).is($(it))) {
					if ($(it).hasClass('active')) {
						if (driverSchoolArray[i] == 1) {
							$(it).find('img').addClass('styleDeg90P');
							driverSchoolArray[i] = 2;
						} else {
							$(it).find('img').removeClass('styleDeg90P');
							driverSchoolArray[i] = 1;
						}
					} else {
						$(it).addClass('active');
						$(it).find('.arrow').attr('src', '../../icon/home/blue_arrow_top.png');
					}
				} else {
					$(e).removeClass('active');
					$(e).find('.arrow').attr('src', '../../icon/home/gray_arrow_top.png');
				}
			})
			sort(i, driverSchoolArray[i], keyWords);
			driverSchoolSelect = [i, driverSchoolArray[i]]
		}
		//医院排序
		var hospitalArray = [1, 1, 1];
		var hospitalSelect = [0, 1, 0];

		function hospitalSort(it, i) {
			$(it).parent().find('li').each(function(index, e) {
				if ($(e).is($(it))) {
					if ($(it).hasClass('active')) {
						if (hospitalArray[i] == 1) {
							$(it).find('img').addClass('styleDeg90P');
							hospitalArray[i] = 2;
						} else {
							$(it).find('img').removeClass('styleDeg90P');
							hospitalArray[i] = 1;
						}
					} else {
						$(it).addClass('active');
						$(it).find('.arrow').attr('src', '../../icon/home/blue_arrow_top.png');
					}
				} else {
					$(e).removeClass('active');
					$(e).find('.arrow').attr('src', '../../icon/home/gray_arrow_top.png');
				}
			})
			sort(i, hospitalArray[i], keyWords);
			hospitalSelect = [i, hospitalArray[i]]
		}
		//教练排序
		var drivingCoachArray = [1, 1, 1];
		var drivingCoachSelect = [2, 1, 0]

		function drivingCoachSort(it, i) {
			$(it).parent().find('li').each(function(index, e) {
				if ($(e).is($(it))) {
					if ($(it).hasClass('active')) {
						if (drivingCoachArray[i] == 1) {
							$(it).find('img').addClass('styleDeg90P');
							drivingCoachArray[i] = 2;
						} else {
							$(it).find('img').removeClass('styleDeg90P');
							drivingCoachArray[i] = 1;
						}
					} else {
						$(it).addClass('active');
						$(it).find('.arrow').attr('src', '../../icon/home/blue_arrow_top.png');
					}
				} else {
					$(e).removeClass('active');
					$(e).find('.arrow').attr('src', '../../icon/home/gray_arrow_top.png');
				}
			})
			sort(i, drivingCoachArray[i], keyWords);
			drivingCoachSelect = [i, drivingCoachArray[i]]
		}
		//sortType第几项 sort 1正续 2倒叙
		function sort(sortType, sort, keyWords) {
			console.log(keyWords)
			if (target_index == 0) {
				esc_function('', 'signUp', 'refreshList(' + sortType + ',' + sort + ',"' + keyWords + '")');
			} else if (target_index == 1) {
				esc_function('', 'physicalExamination', 'refreshList(' + sortType + ',' + sort + ',"' + keyWords + '")');
			} else if (target_index == 2) {
				esc_function('', 'drivingCoach', 'refreshList(' + sortType + ',' + sort + ',"' + keyWords + '")');
			}
		}

		//打开筛选框
		function openScreen(name) {
			sendEvent('screenName',{screenName:name})
			api.openDrawerPane({
				name: 'search_detail',
				type: 'right'
			});
		}
		//打开筛选框
		function openCoachScreen() {
			log('pageParam', pageParam);
			// api.openFrame({
			//           name: 'coach_select_shadow',
			//           url: './driving_coach/coach_select_shadow.html',
			//           bgColor: 'rgba(0,0,0,0.3)',
			//           rect: {
			//               x: 0,
			//               y: 0,
			//               w: 'auto',
			//               h: 'auto'
			//           },
			//           bounces: false,
			//           pageParam:pageParam,
			//           reload:true,
			//           softInputBarEnabled:true,
			//           softInputMode:'resize'
			//       });
			sendEvent('coachpageParam', pageParam)
			api.setFrameAttr({
				name: 'coach_search_detail',
				rect: {
					x: 0,
					y: 0,
					w: 'auto',
					h: api.winHeight
				},
				hidden: false
			});
		}
		//显示地区选择
		function showLocation() {
			esc_function('index', 'signExamination', 'showCitySel()');
		}

		//click样式
		function changeMenu(index) {
			f_slide($(".aui-bar-btn-item").eq(index));
			setViewFrame(index);
		}

		function closeWin() {
			api.closeWin({});
		}
		var keyWords = '';

		function showSearch() {
			keyWords = $('#search-input').val();
			console.log('132++++'+keyWords)
			if (target_index == 2) {
				sort(drivingCoachSelect[0], drivingCoachSelect[1], keyWords)
			} else if (target_index == 1) {
				sort(hospitalSelect[0], hospitalSelect[1], keyWords)
			} else if (target_index == 0) {
				sort(driverSchoolSelect[0], driverSchoolSelect[1], keyWords)
			}

		}
		//监听输入框输入
		$('#search-input').bind('input propertychange', function() {
			if ($(this).val() != '') {
				$(".img_delete").css("display", "block");
			} else {
				$(".img_delete").css("display", "none");
			}
		});
		$(".img_delete").click(function() {
			$("#search-input").val("");
			$(".img_delete").css("display", "none");
			keyWords = "";
		})
	</script>
</html>
