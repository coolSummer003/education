<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>科目三</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/aui/aui.css" />
    <link rel="stylesheet" type="text/css" href="../../css/common/common.css" />
    <style>
    	html,body{
    		background:#FFF;
    	}
    	.aui-grid [class*=aui-col-xs-]:active {
		    background-color: #FFFFFF;
		}
    	.daoh{
		    height: 1.5rem;
    		margin: 0 auto;
    	}
    	.title{
    		padding: 0.75rem 0.75rem 0rem 0.75rem;
    		border-top: solid 1px #DDDDDD;
    	}
		.aui-list {
		    border: none;
		    background-size: 100% 1px;
		    background-repeat: no-repeat;
		    background-position: top;
		    background-image: linear-gradient(0,#FFF,#FFF 50%,transparent 50%) !important;
		}
		.aui-list .aui-list-item-media {
		    width: 6.5rem;
		    position: relative;
		    padding: 0.5rem 0;
		    padding-right: 0.75rem;
		    display: inherit;
		    -webkit-flex-shrink: 0;
		    flex-shrink: 0;
		    -webkit-flex-wrap: nowrap;
		    flex-wrap: nowrap;
		    -webkit-box-align: center;
		    -webkit-align-items: flex-start;
	        display: flex;
		    align-items: center;
		    justify-content: center;
		}
		.blue{
			color:#03A9F4;
		}
		.aui-ellipsis-2 {
		    display: -webkit-box !important;
		    overflow: hidden;
		    text-overflow: ellipsis;
		    word-wrap: break-word;
		    word-break: break-all;
		    white-space: normal !important;
		    -webkit-line-clamp: 2;
		    -webkit-box-orient: vertical;
		}
		.aui-list .aui-list-item-media img {
		    width: 100%;
	        height: 100%;
		    display: block;
    		object-fit: cover;
		}
		.border-none{
			border:none !important;
			background:none !important;
			padding: 0;
		    min-height: 0rem;
		}
		.small-font{
			font-size:0.6rem;
		}
		.label{
			font-size: 0.5rem;
		    background: #49C5FA;
		    color: #FFF;
		    position: absolute;
		    bottom: 0;
		    left: 0;
		    padding: 0 0.1rem;
		}
		.vedio-group{
			position:relative;
		    height: 100%;
		}
		.aui-list [class*=aui-col-xs-] img {
		    max-width: 100%;
		    width: 100%;
		    display: block;
		    height: 3rem;
		    border-radius: 2px;
		}
		.aui-media-list .aui-list-item-inner {
		    display: block;
		    padding-top: 0.5rem;
		    padding-bottom: 0.5rem;
		    margin: auto;
		}
		.aui-media-list-item-inner {
		    -webkit-box-sizing: border-box;
		    box-sizing: border-box;
		    display: -webkit-box;
		    display: -webkit-flex;
		    display: flex;
		    min-height: 5rem;
		}
		.aui-list .aui-list-item {
		    background-size: 100% 1px;
		    background-repeat: no-repeat;
		    background-position: bottom;
		    background-image: linear-gradient(0,#FFF,#FFF 50%,transparent 50%);
		    background-image: -webkit-linear-gradient(90deg,#FFF,#FFF 50%,transparent 50%);
		}
		.font-bigger{
			font-size:0.8rem;
			color:#505050;
		}
		.msg{
			background: #FFFFFF;
			height: 20rem;
			text-align: center;
			font-size:0.7rem;
		}
		.msg img{
			width:8rem;
			margin-top: 9rem;
			margin-left: 5.5rem;
		}
		.jiazai {
			font-size: 0.7rem;
			background: #FFFFFF;
			color: #666565;
			padding-bottom: 0.3rem;
			text-align: center;
			padding-top: 0.3rem;
		}

		.jiazai img {
			width:1.5rem;
		}
    </style>
</head>
<body>
    <div class="aui-content">
    	<ul class="aui-list aui-media-list" id="subject_skill">
    	</ul>
    	<script type="text/template" charset="utf-8" id='subject_skill_src'>
    		{{ for(var i=0;i<it.length;i++){ }}
				{{ if(it[i].video == undefined || it[i].video == null  || it[i].video == ""){ }}
		    		{{ if(it[i].model == 1){ }}
		    			<li class="aui-list-item bottom-slide" tapmode onclick='openDetail("{{=it[i].id}}","{{=it[i].title}}","drivingSkill")'>
				            <div class="aui-media-list-item-inner">
				                <div class="aui-list-item-inner">
				                    <div class="aui-list-item-text" style="margin: 0.3rem 0rem;">
				                    	<div class="aui-info-item-title aui-ellipsis-2 font-bigger">
				                        	{{=it[i].title}}
				                        </div>
				                    </div>
				                    <!-- <div class="aui-list-item-text" style="margin: 0.3rem 0rem;">
				                    	<div class="aui-info-item small-font">
				                        	{{=it[i].view}}次浏览 &ensp;{{=it[i].optinion}}评论
				                        </div>
				                    </div> -->
				                </div>
				                <div class="aui-list-item-media">
				                	{{ for(var j=0;j<it[i].image.split(',').length;j++){ }}
					                	<div class="vedio-group" >
											<img src="../../icon/default/icon_default_big_pic.png"  onerror="javascript:this.src='../../icon/default/icon_default_big_pic.png'" data-echo="{{=file_load_url + it[i].image.split(',')[j]}}" style="object-fit: content;" />
										</div>
				                	{{ } }}
				                </div>
				            </div>
				        </li>
		    		{{ }else if(it[i].model == 2){ }}
		    			<li class="aui-list-item bottom-slide" tapmode onclick='openDetail("{{=it[i].id}}","{{=it[i].title}}","drivingSkill")'>
				            <div class="aui-media-list-item-inner">
				                <div class="aui-list-item-inner">
				                    <div class="aui-list-item-text" style="margin: 0.3rem 0rem;">
				                    	<div class="aui-info-item-title aui-ellipsis-2 font-bigger">
				                        	{{=it[i].title}}
				                        </div>
				                    </div>
						            <div class="aui-row aui-row-padded" id="modelTwoImg{{=it[i].id}}">
						            	{{ for(var j=0;j<it[i].image.split(',').length;j++){ }}
											<div class="aui-col-xs-4">
												<img src="../../icon/default/icon_default_big_pic.png"  onerror="javascript:this.src='../../icon/default/icon_default_big_pic.png'" data-echo="{{=file_load_url + it[i].image.split(',')[j]}}" style="object-fit: cover;" />
											</div>
					                	{{ } }}
						            </div>
				                    <!-- <div class="aui-list-item-text" style="margin: 0.3rem 0rem;float: right;">
				                    	<div class="aui-info-item small-font">
				                        	{{=it[i].view}}次浏览 &ensp;{{=it[i].optinion}}评论
				                        </div>
				                    </div> -->
				                </div>
				            </div>
				        </li>
					{{ } }}
	    		{{ }else{ }}
	    			<li class="aui-list-item bottom-slide" tapmode onclick='openDetail("{{=it[i].id}}","{{=it[i].title}}","video")'>
			            <div class="aui-media-list-item-inner">
			                <div class="aui-list-item-inner">
			                    <div class="aui-list-item-text" style="margin: 0.3rem 0rem;">
			                    	<div class="aui-info-item-title aui-ellipsis-2 font-bigger">
			                        	{{=it[i].title}}
			                        </div>
			                    </div>
			                    <!-- <div class="aui-list-item-text" style="margin: 0.3rem 0rem;">
			                    	<div class="aui-info-item small-font">
			                        	{{=it[i].view}}次播放 &ensp;{{=it[i].optinion}}评论
			                        </div>
			                    </div> -->
			                </div>
			                <div class="aui-list-item-media">
			                	<div class="vedio-group" >
									<div class='label'>视频</div>
									<img src="../../icon/default/icon_default_big_pic.png" onerror="javascript:this.src='../../icon/default/icon_default_big_pic.png'" data-echo="{{=file_load_url + it[i].image}}" style="object-fit: cover;" />
								</div>
			                </div>
			            </div>
			        </li>
	    		{{ } }}
	        {{ } }}
    	</script>
    </div>
	<div id='load_div'>
	</div>
	<script type="text/template" charset="utf-8" id='load_src'>
		<div class="load">
		<img src="../../icon/common/loadding.gif" alt="" /><br>
		<span>加载中...</span>
	</div>
	</script>
		<script type="text/template" charset="utf-8" id='msg_src'>
			<div class="msg">
				<img src="../../icon/common/empty.png" alt="" /><br>
				<span>{{=it.msg}}</span>
			</div>
	</script>
		<script type="text/template" charset="utf-8" id='more_src'>
			<div class="jiazai">
			<span>{{=it.msg}}</span> 
		</div>
	</script>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/jquery_3_2_1_min.js"></script>
	<script src="../../script/echo.min.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" src="../../script/doT_min.js"></script>
<script type="text/javascript" src="../../script/common/common.js"></script>
<script type="text/javascript">
	var cache;
	var page=1;
	var limit=10;
	var kemu;  //科目
	var categoryA; //考试项目详解
	var categoryB; //详解考试要领
	var load_src = $('#load_src').html(); //加载src
	var msg_src = $('#msg_src').html(); //消息提示src
	var more_src = $('#more_src').html(); //更多src
	var refresh = true; //标记是否是刷新操作
	var imgs; //存放图片
	apiready = function(){
		cache = api.pageParam;
		log("科目",cache)
		goRefrash(40, '#FFFFFF', null, null, function() {
			refreshList();
		});
		goLoad(function(ret, err) {
			loadList();
		});
		setTimeout(function() {
			api.refreshHeaderLoading();
		}, 100);
		// init();
	};
	//列表刷新
	function refreshList() {
		page = 1;
		refresh = true;
		setLoad();
		init();
		//延迟加载图片
		setTimeout(function() {
			echoInit();
		}, 300);
	}
	//列表上拉
	function loadList() {
		page++;
		refresh = false;
		setLoad();
		init();
		//延迟加载图片
		setTimeout(function() {
			echoInit();
		}, 300);
	}
	
	function init(){
		if(cache.flag == 'drivingSkill'){
			//驾考技巧
			var url="api/knowledge/getKnowledgeList";
			getKnowledgeList(url)
			if(cache.flag == 'drivingSkill' && cache.kemu == '036002'){
					onEvent('exam21','科目二-驾考技巧');
			}
			if(cache.flag == 'drivingSkill' && cache.kemu == '036003'){
					onEvent('exam31','科目三-驾考技巧');
			}
		}else if(cache.flag == 'all'){
			//考试项目详解全部
			var url="api/knowledge/getKnowledgeList";
			getKnowledgeList(url)
			if(cache.flag == 'all' && cache.kemu == '036002'){
					onEvent('exam22','科目二-考试项目详解');
			}
			if(cache.flag == 'all' && cache.kemu == '036003'){
					onEvent('exam32','科目三-考试项目详解');
			}
		}else if(cache.flag == 'video'){
			//考试项目详解视频
			var url="api/knowledge/getKnowledgeListVideo"
			getKnowledgeList(url)
		}
		setTimeout(function() {
			api.refreshHeaderLoadDone();
		}, 500);
	}
	function getKnowledgeList(url){
		params={
			kemu:cache.kemu,
			categoryA:cache.categoryA,
			categoryB:cache.categoryB,
			status:'011001',//有效的
			page:page,
			limit:limit
		}
		ajax_Request(url,"get","json",params,function(ret,err){
			log("要领++++",ret);
			if(ret){
				if(ret.code == 0 && ret.knowledgeList.length > 0){
					var subject_skill_src = $('#subject_skill_src').html();
					$("#subject_skill").html(doT.template( subject_skill_src )( ret.knowledgeList ));
				}else{
					setMsg(!refresh ?'暂无更多' : cache.flag == 'drivingSkill'?'暂无技巧':'暂无详解');
				}
			}else{
				setMsg("服务器繁忙，请稍后重试");
			}
		})
	}
	//设置页面加载的画面
	function setLoad() {
		if (refresh || $('.aui-content').find('li').length == 0) { //如果是刷新或者之前无数据的下拉刷新，全屏提示
			$('#load_div').html('');
		} else {
			setTimeout(function() {
				$('#load_div').html(doT.template(more_src)({
					'msg': '加载更多中...',
					'img': '../../icon/common/jiazai.gif'
				}));
			}, 500);
		}
	}

	//设置页面提示信息
	function setMsg(msg) {
		if (refresh || $('#subject_skill').find('li').length == 0) { //如果是刷新或者之前无数据的上拉加载，全屏提示
			setTimeout(function() {
				$("#subject_skill").html(doT.template(msg_src)({
					'msg': msg
				}));
			}, 500);
		} else { //原先已经有数据的情况下
			setTimeout(function() {
				$('#load_div').html(doT.template(more_src)({
					'msg': msg,
					'img': ''
				}));
			}, 500);
		}
	}
	
	//打开详情
	function openDetail(id,name,isvideo){
		param = {
			id:id,
			name:name,
			flag:isvideo,
			kemu:cache.kemu,
			categoryA:cache.categoryA,
			categoryB:cache.categoryB
		}
		commonOpenWin('subject_skill_detail_win',param);
	}
</script>
</html>