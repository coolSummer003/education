<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1.0" />
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>通用弹出框</title>
		<link rel="stylesheet" type="text/css" href="../../css/api.css" />
		<link rel="stylesheet" type="text/css" href="../../css/aui/aui_2_0.css" />
		<link rel="stylesheet" type="text/css" href="../../css/common/common.css" />
		<style>
			html{
    		background: transparent;
    		height:100%;
    	}
    	body{
    		width: 100%;
    		height:100%;
    		background: transparent;
    		display:flex;
    	}
    	.attention-div{
    		margin: auto;
		    position: absolute;
		    height: 100%;
			-webkit-transform: scale(0);
			transform:scale(0);
			opacity: 0;
			width: 100%;
		    padding: 2rem 1rem 0rem 1rem;
	        background: #FFF;
    	}
    	.shadow{
    		width:100%;
    		height:100%;
    		background:#000;
    		opacity:0;
    		position: absolute;
    	}
    	.trans {
            /*transition*/
            -webkit-transition: 0.3s ease;
            -moz-transition: 0.3s ease;
            -ms-transition: 0.3s ease;
            -o-transition: 0.3s ease;
            transition: 0.3s ease;
        }
        .show{
			-webkit-transform: scale(1);
			transform:scale(1);
			opacity: 1;
        }
		.sure{
		    height: 2rem;
		    line-height: 2rem;
		    background: #DC251F;
		    color: #FFF;
		    border-radius: 0.2rem;
		}
		.message-txt{
		    width: 90%;
		    margin: auto;
		    text-align: center;
		    font-size: 0.7rem;
		    height: 25rem;
		    -webkit-transform: scale(0);
			transform:scale(0);
			opacity: 0;
			background: #FFF;
			border-radius: 0.5rem;
		}
		.message-txt-title{
			width: 100%;
		    height: 2.5rem;
		    line-height: 2.5rem;
		    border-radius: 0.5rem 0.5rem 0rem 0rem;
    		border-bottom: none;
    		font-weight: bold;
    		color:#4D4D4D;
    		font-size:0.9rem;
		}
		.message-txt-content{
		    width: 100%;
		    height: 2.5rem;
		    text-align: left;
		    display: flex;
		    line-height: 1.3rem;
		    color:#4D4D4D;
		}
		.message-txt-content span{
			margin: 0.5rem 0.85rem;
			padding: 0 0.1rem 0 0.5rem;
		    font-size: 0.8rem;
		}
		.message-txt-button{
	        width: 86%;
		    height: 2rem;
		    line-height: 2rem;
		    background: linear-gradient(to left, #03B4F7 , #90DBF7);
		    color: #fff;
		    border-radius: 1rem;
		    margin-left: 7%;
		    position:absolute;
		    bottom:0.85rem;
		}
		/* .message-txt-button:active{
			background:#90DBF7;
		} */
		.in{
			-webkit-transform: scale(1);
			transform:scale(1);
			opacity: 1;
		}
		.bottom-slide-red {
		    position: relative;
		}
		.bottom-slide-red:after {
		    content: '';
		    height: 1px;
		    background: #DDDDDD;
		    width: 100%;
		    display: block;
		    -webkit-transform: scaleY(0.3);
		    transform: scaleY(0.3);
		    -webkit-transform-origin: 30% 100%;
		    transform-origin: 30% 100%;
		    bottom: 0;
		    left: 0;
		    position: absolute;
		}
		.small{
		    width: 35%;
		    float: left;
		    margin-left: 10%;
		}
		.images{
			padding-top:3rem;
			width:90%;
			height:18.5rem;
			object-fit: cover;
		}
		.images_second{
			padding-top:1.5rem;
			width:90%;
			height:18.5rem;
			object-fit: cover;
		}
		.image_third{
			width:85%;
			height:18rem;
			object-fit: cover;
			margin-top: 1rem;
		}
		.images_four{
			width:86.4%;
			height:9.56rem;
			object-fit: cover;
		}
		.images_five{
			width:86.4%;
			height:9.56rem;
			object-fit: cover;
		}
		.message-txt-image{
			margin-top:-2.5rem;
				
		}
		.message-txt-image-two{
			margin-top:-4.2rem;
			z-index: 999;
		}
		.message-txt-image-third{
			margin-top:-2.6rem;
		}
		.sure_btn{
			background: linear-gradient(to left ,#3F86FE,#64ADF6);
		}
		.sure_btn_h{
			background: #DDDDDD;
		}
		.images_auto{
			padding-top:2rem; 
			width:78%;
			height: 19rem;
			/* object-fit: cover; */
		}
		.img_color{
			padding-top:0.25rem !important;  
			height: 19.5rem !important;
		}
		.message-txt-color{
		    width: 90%;
		    margin: auto;
		    text-align: center;
		    font-size: 0.7rem;
		    height: 30rem;
		    -webkit-transform: scale(0);
			transform:scale(0);
			opacity: 0;
			background: #FFF;
			border-radius: 0.5rem;
		}
		.small_left{
			margin-left: 60%;
		}
		.cancel_btn{
			background:rgba(245,247,247,1);
			color: #3F86FF;
		}
		.rightTopTime{
			position: fixed;
			/* left: 35%; */
			top: 35%;
			width: 100%;
			/*height: 8rem; */
			/* line-height: 8rem; */
			font-size: 8rem;
			text-align: center;
			color: #3F86FF;
			/* background: #fff; */
			/* border-radius: 50%; */
		}
		.iconBorder{
			position: fixed;
			top: 10%;
			width: 100%;
			height: 90%;
			text-align: center;
		}
		.iconBorder img{
			width: 100%;
			height: 100%;
		}
    </style>
	</head>
	<body>
		<!-- 提示说明 -->
		<div class='message-txt trans' id="messageTxt">
			<div class='message-txt-title bottom-slide-red'>标题</div>
			<div class='message-txt-content'><span>--内容--</span></div>
			
			<div class='message-txt-image' id="color">
				<img src="../../image/data/data/color_select.png" class="images_auto img_color" />
				<!--<img src="../../image/data/leftEye_two.jpg" class="images_second"/>-->
			</div>
			<div class='message-txt-image' id="colorflip">
			    <img src="../../image/data/data/flip_phone.gif" class="images_second" style="margin-top: 5rem;height: 14rem;"/>
			</div>
			<div class='message-txt-image' id="eye">
				<img src="../../image/data/data/eye_select.png" class="images_auto" />
				<!--<img src="../../image/data/leftEye_two.jpg" class="images_second"/>-->
			</div>
			
			<div class='message-txt-image' id="rightEye">
				<img src="../../image/data/data/left_eye.gif" class="images_second" />
				<!--<img src="../../image/data/leftEye_two.jpg" class="images_second"/>-->
			</div>
			
			<div class='message-txt-image' id="leftEye">
				<!-- <img src="../../image/data/rightEye.jpg" class="images"/> -->
				<img src="../../image/data/data/right_eye.gif" class="images_second" />
				
				<!--<img src="../../image/data/rightEye_two.jpg" class="images_second"/>-->
			</div>
			
			<div class="message-txt-image" id="listen">
				<!-- <img src="../../image/data/listen_new.jpg"/ class="image_third"> -->
				<img src="../../image/data/data/listen_leason.gif" class="images_second" />
			</div>
			
			<div class='message-txt-image' id="trunk">
				<img src="../../image/data/data/ex_leason.gif" class="images_second" />
				<!-- <img src="../../image/data/trunk_new_one.jpg" class="images_four"/> -->
				<!-- <img src="../../image/data/trunk_new_two.jpg" class="images_five"/> -->
			</div>
			<div class='message-txt-image' id="eyeflip">
			    <!--<span style="color:#FF0000;width: 90%;font-size: 1rem;"></span>-->
			    <img src="../../image/data/data/flip_phone.gif" class="images_second" style="margin-top: 5rem;height: 14rem;"/>
			    <!-- <img src="../../image/data/trunk_new_one.jpg" class="images_four"/> -->
			    <!-- <img src="../../image/data/trunk_new_two.jpg" class="images_five"/> -->
			</div>
			<div class='message-txt-button sure_btn_h' id='sureButton'>确定</div>
			<div class='message-txt-button small_left small aui-hide sure_btn_h' id='cancelButton'>取消</div>
			
			<audio src="" id="fry_audio" autoplay="autoplay"></audio>
		</div>
		<div class="iconBorder aui-hide">
			<img src="../../image/data/data/img_border.png" >
		</div>
		<div id="topTimes" class="rightTopTime aui-hide">15
			<!-- <img src="../../image/gif/count_down.gif" > -->
		</div>
	</body>
	<script type="text/javascript" src="../../script/api.js"></script>
	<script type="text/javascript" src="../../script/jquery_3_2_1_min.js"></script>
	<script type="text/javascript" src="../../script/common/common.js"></script>
	<script type="text/javascript">
		var cache;
		var times = 0;
		apiready = function() {
			api.parseTapmode();
			cache = api.pageParam;
			console.log("213132123132" + JSON.stringify(cache));
			$('.message-txt-title').html(cache.title);
			$('.message-txt-content').find('span').html(cache.content);
			$('#sureButton').html(cache.sureButton);
			//视力体检图片提示
			
			if(cache.type == "color"){
				// res/voice/audio_1.mp3
				playAudio('../../res/voice/color_leason.mp3')
				$("#listen").attr("style", "display:none;");
				$("#rightEye").attr("style", "display:none;");
				$("#trunk").attr("style", "display:none;");
				$("#leftEye").attr("style", "display:none;");
				$("#eye").attr("style", "display:none;");
				$("#colorflip").attr("style", "display:none;");
				$("#eyeflip").attr("style", "display:none;");
				// $(".message-txt-content").attr("style", "height:2rem;");
				// $('#sureButton').removeClass("message-txt");
				// $('#sureButton').addClass("message-txt-color");
				$("#color").attr("style", "");
			}
			
			if(cache.type == "eye"){
				playAudio('../../res/voice/eye_leason.mp3')
				$("#listen").attr("style", "display:none;");
				$("#rightEye").attr("style", "display:none;");
				$("#trunk").attr("style", "display:none;");
				$("#leftEye").attr("style", "display:none;");
				$("#color").attr("style", "display:none;");
				$("#colorflip").attr("style", "display:none;");
				$("#eyeflip").attr("style", "display:none;");
				$("#eye").attr("style", "");
			}
			//右眼
			if (cache.type == "right") {
				playAudio('../../res/voice/left_eye_leason.mp3')
				$("#leftEye").attr("style", "display:none;");
				$("#listen").attr("style", "display:none;");
				$("#trunk").attr("style", "display:none;");
				$("#color").attr("style", "display:none;");
				$("#eye").attr("style", "display:none;");
				$("#colorflip").attr("style", "display:none;");
				$("#eyeflip").attr("style", "display:none;");
				// $(".message-txt").css("height","23rem");
				$("#rightEye").attr("style", "");
			}
			// else{
			// 	$("#rightEye").attr("style","display:none;");
			// 	$("#listen").attr("style","display:none;");
			// 	$("#trunk").attr("style","display:none;");
			// }
			//左眼
			if (cache.type == "left") {
				playAudio('../../res/voice/right_eye_leason.mp3')
				$("#listen").attr("style", "display:none;");
				$("#rightEye").attr("style", "display:none;");
				$("#trunk").attr("style", "display:none;");
				$("#color").attr("style", "display:none;");
				$("#eye").attr("style", "display:none;");
				$("#colorflip").attr("style", "display:none;");
				$("#eyeflip").attr("style", "display:none;");
				// $(".message-txt").css("height","23rem");
				$("#leftEye").attr("style", "");
			}

			//听力体检图片提示
			if (cache.type == "listen") {
				playAudio('../../res/voice/listen_leason.mp3')
				$("#leftEye").attr("style", "display:none;");
				$("#rightEye").attr("style", "display:none;");
				$("#trunk").attr("style", "display:none;");
				$("#color").attr("style", "display:none;");
				$("#eye").attr("style", "display:none;");
				$("#colorflip").attr("style", "display:none;");
				$("#eyeflip").attr("style", "display:none;");
				// $(".message-txt").css("height","23rem");
				$("#listen").attr("style", "");
			}
			
			//头部颈部图片提示
			if (cache.type == "trunk") {
				playAudio('../../res/voice/ex_leason.mp3')
				$("#leftEye").attr("style", "display:none;");
				$("#rightEye").attr("style", "display:none;");
				$("#listen").attr("style", "display:none");
				$("#color").attr("style", "display:none;");
				$("#eye").attr("style", "display:none;");
				$("#colorflip").attr("style", "display:none;");
				$("#eyeflip").attr("style", "display:none;");
				$("#trunk").attr("style", "");
			}
			
			//辨色力旋转提示
			if (cache.type == "colorflip") {
			    playAudio('../../res/voice/rotate_color_leason.mp3')
			    $("#leftEye").attr("style", "display:none;");
			    $("#rightEye").attr("style", "display:none;");
			    $("#listen").attr("style", "display:none");
			    $("#color").attr("style", "display:none;");
			    $("#eye").attr("style", "display:none;");
			    $("#trunk").attr("style", "display:none;");
				$("#eyeflip").attr("style", "display:none;");
			    $("#colorflip").attr("style", "");      
			}
			
			//视力旋转提示
			if (cache.type == "eyeflip") {
			    playAudio('../../res/voice/rotate_eye_leason.mp3')
			    $("#leftEye").attr("style", "display:none;");
			    $("#rightEye").attr("style", "display:none;");
			    $("#listen").attr("style", "display:none");
			    $("#color").attr("style", "display:none;");
			    $("#eye").attr("style", "display:none;");
			    $("#trunk").attr("style", "display:none;");
				$("#colorflip").attr("style", "display:none;");
			    $("#eyeflip").attr("style", "");      
			}
			
			//end
			// if (cache.type == "end") {
			// 	$(".message-txt").css("height","12rem");
			// 	playAudio('res/voice/end_leason.mp3')
			// 	$("#leftEye").attr("style", "display:none;");
			// 	$("#rightEye").attr("style", "display:none;");
			// 	$("#listen").attr("style", "display:none");
			// 	$("#color").attr("style", "display:none;");
			// 	$("#eye").attr("style", "display:none;");
			// 	$("#trunk").attr("style", "display:none;");
				
			// }
			
			
			
			if (cache.cancelButton != '') {
				$('#sureButton').addClass('small');
				$('#cancelButton').removeClass('aui-hide');
				$('#cancelButton').html(cache.cancelButton);
				// setTimeout(function() {
				// 	document.getElementById('cancelButton').onclick = function() {
				// 		cancel();
				// 	}
				// }, 300);
			}
			$('#messageTxt').addClass('in');
			// setTimeout(function(){
			// 	document.getElementById('sureButton').onclick = function(){
			// 		sure();
			// 	}
			// 	api.parseTapmode();
			// },300);
		}

		//点击执行按钮
		function sure() {
			$('#messageTxt').removeClass('in');
			setTimeout(function() {
				//如果有事件，优先回调事件
				if (cache.params != null &&
					cache.params != undefined &&
					cache.params.send_event_name != null &&
					cache.params.send_event_name != undefined) {
					sendEvent(cache.params.send_event_name, cache.params.data);
				} else {
					if (cache.sureFunc != '' && cache.sureFunc != undefined) {
						esc_function(cache.winName, cache.frameName, cache.sureFunc);
					}
				}
				close_alert();
			}, 300);
		}

		//点击取消按钮
		function cancel() {
			$('#messageTxt').removeClass('in');
			setTimeout(function() {
				if (cache.cancelFunc != '' && cache.cancelFunc != undefined) {
					esc_function(cache.winName, cache.frameName, cache.cancelFunc);
				}
				close_alert();
			}, 300);
		}

		//关闭弹窗
		function close_alert() {
			api.closeFrame({
				name: 'common_alert_second'
			});
		}

		//倒计时3秒
		function countdownLeft(second) {
			for (var i = second; i >= 1; i--) {
				(function(e) {
					setTimeout(function() {
						$('#sureButton').text(cache.sureButton + "(" + e + ")");
					}, 1000 * (second - e));
				})(i)
			}
		}
		
		//右侧按钮倒计时3秒
		function countdownRight(second) {
			for (var i = second; i >= 1; i--) {
				(function(e) {
					setTimeout(function() {
						$('#cancelButton').text(cache.cancelButton + "(" + e + ")");
					}, 1000 * (second - e));
				})(i)
			}
		}


		function playAudio(videoUrl) {
			$('#fry_audio').attr('src',videoUrl);
			var fry_audio = $('#fry_audio');
			fry_audio.paused;
			setTimeout(function(){
				//取整
				times = Math.ceil(document.getElementById("fry_audio").duration) ;
				
				if (cache.type == "trunk") {
					countdownLeft(times);
					//倒计时
					setTimeout(function() {
						$('#sureButton').removeClass("sure_btn_h");
						$('#sureButton').addClass("sure_btn");
						$('#sureButton').text(cache.sureButton)
						api.parseTapmode();
					}, times * 1000);
					
					setTimeout(function() {
						// sure();
						topTime()
						api.parseTapmode();
					}, times * 1000);
					
				} else {
					countdownLeft(times);
					
					//倒计时
					setTimeout(function() {
						$('#sureButton').removeClass("sure_btn_h");
						$('#sureButton').addClass("sure_btn");
						$('#sureButton').text(cache.sureButton)
						api.parseTapmode();
					}, times * 1000);
					
					if (cache.cancelButton != '') {
						countdownRight(times);
						setTimeout(function() {
							$('#cancelButton').removeClass("sure_btn_h");
							$('#cancelButton').addClass("cancel_btn");
							$('#cancelButton').text(cache.cancelButton)
							document.getElementById('cancelButton').onclick = function() {
								cancel();
							}
							api.parseTapmode();
						}, times * 1000);
					}
					
					setTimeout(function() {
						document.getElementById('sureButton').onclick = function() {
							sure();
						}
						api.parseTapmode();
					}, times * 1000);
				}
				times = 0
				
			},1000)
		}
		
		
		function topTime(){
			$('#messageTxt').addClass("aui-hide")
			$('#topTimes').removeClass("aui-hide");
			$('.iconBorder').removeClass("aui-hide");
			
			// $('.rightTopTime').html("5");
			// countdownLeft(5);
			var timeR = 15;
			var timesInter = setInterval(function(){
				timeR--
				$('#topTimes').html(timeR);
				if(timeR < 0){
					$('#topTimes').addClass("aui-hide");
					sure();
					clearInterval(timesInter)
				}
			},1000)
		}
		
	</script>
</html>
