<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>申请开票</title>
		<link rel="stylesheet" type="text/css" href="../../css/api.css" />
		<link rel="stylesheet" type="text/css" href="../../css/aui/aui_2_0.css" />
		<link rel="stylesheet" type="text/css" href="../../css/common/common.css" />
		<link rel="stylesheet" type="text/css" href="../../css/common/comment.css" />
		<style>
			html,body{
    		background-color:#F4F5F7;
			height:100%;
			
    	}
		  	
    	.aui-grid{
    	position:absolute;
    
    	width: 100%;
    	height:100%;
    
    	padding-top: 0.4rem;
    	}
    	.aui-grid [class*=aui-col-] {
		    display: table-cell;
		    position: relative;
		    text-align: center;
		    vertical-align: middle;
		    padding: 0.5rem 0;
		}
		.shadow{
		    position: absolute;
		    bottom: 0rem;
		    top: 0rem;
		    width: 100%;
		}
		.aui-grid [class*=aui-col-xs-]:active {
		    background-color: #FFFFFF;
		}
	
		.aui-card-list-header{
		font-size:0.9rem;
		font-weight: bold;
		
		white-space:nowrap;
		}
		.aui-tips-title{
		line-height:0.9rem;
		}
		footer{
    		height: 2.5rem;
		    position:fixed;
		    bottom: 0;
		    width: 100%;
		    font-size: 0.8rem;
		    left: 0;
		    background: #ffffff;
    	}
		.footer-input{

		    height: 3rem;
		    width: 100%;
			padding-left:1rem;
			padding-right:1rem;
		
		}
		.footer-input div{
		    min-height: 1.7rem;
			background: linear-gradient(to right, #78D6FA , #05B4F7); 
		    padding: 0 0.5rem;
		    margin-top: 0.4rem;
		    border-radius: 1rem;
		    line-height: 1.7rem;
		}
		.mian-content{
			position: absolute;
			top:0rem;
			right: 0rem;
			left: 0rem;
			background:#FFFFFF;
			
			overflow-y: auto;
			overflow-x: hidden;
			overflow-y: scroll;
			-webkit-overflow-scrolling: touch;
		}


	.wrapper{
	
		height:1.5rem;
		float:left;
	
	}
	.wrapper1 {
		display: inline;
		height:1.5rem;
		float:left;
		margin-right:1rem;
	}
	.box {
		display: inline;
		float:left;
		width: 100%;
		height:100%;
		position: relative;
		vertical-align: middle;
		border-radius: 100%;
		text-align: center;
	}
	.box input {
		display:none;
	}
	
	.box label { 
	  display: block;
	  width: 3.5rem;
	  height: 1.45rem;
	 
	  background: #fff;
	  
	  z-index:1;
	  border-radius:0.725rem;
	  border:1px solid #FFFFFF;
	  font-size:0.55rem;
	  line-height: 1.45rem;
	  font-weight:750;
	 
	   
	}
	
	
	input[type="radio"] + label {
		background: #F2F2F2;
		color: #939393;
		border:1px solid #F2F2F2;
	
	}
	input[type="radio"]:checked + label {
	    background:#DDEBFF;
	    border:1px solid #79ADCD;
	    color: #79ADCD;
	}
	.aui-list-item-label{
		height:2rem;
		font-size:0.6rem;
		line-height:2rem;
	}
	span{
		font-size: 0.55rem;
		color: #767676;
		width:85%;
		margin-top:0.25rem;
	}
	.inputs::-webkit-input-placeholder{
	        color:red;
	        }
	#unit{
	        display:none;
	        }
	#unit1{
	         display:block;
	        }
	        #tips-1{

	        }	
		

    </style>
	</head>
	<body>
	
			<div class="mian-content">
					<ul class="aui-list aui-select-list" id="ul">
						<li class="aui-list-item">
							<div class="aui-list-item-inner">
								<div class="aui-card-list-header" style="font-size:0.7rem;">
									发票类型
								</div>
								<div class="aui-list-item-inner">
									<div id="radio">

										<div class="wrapper1">
											<div class="box">
												<input type="radio" checked="checked" id="boy" name="1" />
												<label for="boy" style="width:5rem;">电子普通发票</label>
											</div>
										</div>


									</div>

								</div>
								<span>电子普通发票与纸质普通发票具备同等法律效力，可支持报销入账。<span>
							</div>

						</li>
						
						<li class="aui-list-item">
							<div class="aui-list-item-inner">
								<div class="aui-card-list-header" style="font-size:0.7rem;">
									发票抬头
								</div>
								<div class="aui-list-item-inner">
									<div id="radio1">

										<div class="wrapper1">
											<div class="box">
												<input type="radio" id="is_personal" name="2"  checked="checked"/>
												<label for="is_personal">个人</label>
											</div>

										</div>

										<div class="wrapper">
											<div class="box">
												<input type="radio" id="is_personal1" name="2" />
												<label for="is_personal1">单位</label>
											</div>

										</div>

									</div>



								</div>
								<div id="unit">
									<div class="aui-list-item-label">
										单位名称
										<input type="text" id="entity_name" class="entity_name input" placeholder="请填写单位名称" style="margin-left:2.15rem;font-size:0.6rem;">
									</div>
									<div class="aui-list-item-label">
										纳税人识别号
										<input type="text" id="input" class="inputs input" placeholder="请在此填写纳税人识别号" style="margin-left:1rem;margin-right:1rem;font-size:0.6rem;width:60%;">

									</div>
								</div>
								<div id="unit1">
									<div class="aui-list-item-label">
										开票抬头
										<input type="text" id="name" class="name input" placeholder="请填写开票人姓名" style="margin-left:2.15rem;font-size:0.6rem;">
									</div>

									<div>

									</div>

						</li>
						<li class="aui-list-item">
							<div class="aui-list-item-inner">
								<div class="aui-card-list-header" style="font-size:0.7rem;">
									收票人信息
								</div>

								<div class="aui-list-item-label">
									收票人手机*
									<!--<p style="color:#000000;margin-left:1rem; font-size: 0.6rem;">158****6349</p>-->
									<input type="tel" id="phone" class="phone input" placeholder="用来联系用户，必填" maxlength="11" style="margin-left:1rem;font-size:0.6rem;">
								</div>
								<div class="aui-list-item-label">
									收票人邮箱*
									<input type="email" id="email" class="email input" placeholder="用来接收电子发票邮箱，必填" style="margin-left:1rem;font-size:0.6rem;">
								</div>


							</div>
						</li>
					
					</ul>

				</div>

				<footer id="footer">
					<div class='footer-input'>
					
						<div type="text" value="" id='newComments'  tapmode style="text-align: center;color: #FFFFFF;" tapmode onclick="closeFrm()">确定</div>
					</div>

				</footer>
	</body>
	<script type="text/javascript" src="../../script/api.js"></script>
	<script type="text/javascript" src="../../script/jquery_3_2_1_min.js"></script>
	<script type="text/javascript" src="../../script/doT_min.js"></script>
	<script type="text/javascript" src="../../script/common/common.js"></script>
	
	
	<script type="text/javascript">
		
		var refresh = true; //标记是否是刷新操作
		var bigComment=document.getElementById('bigComment');
		var systemType; //系统类型
		var touchStyle;
		var headerPos;
		var threshold; //定义的阈值
		var articleId;
		var orderId;
		var organizationType;
		var is_personal; //发票抬头
		var name; //收票人姓名
		var phone; //电话
		var mail; //邮箱
		var entity_name; //单位名称	
		var ein; //税号
		var cache;
		var kemu,isVip;
		var testCenterId,hospitalId,schoolId;
		apiready = function() {
			 
			cache = api.pageParam.data;
			systemType = api.systemType;
			touchStyle = systemType == "ios" ? 'touchmove' : 'scroll';
			//title标题 content内容 sureButton确认按钮文字 cancelButton取消按钮文字 sureFunc确定方法 cancelFunc取消方法  params额外参数，没有必须传null
			//openMessage(title, content, sureButton, cancelButton, sureFunc, cancelFunc, params)
			openMessage('温馨提示', '&emsp;&emsp;启用电子普通发票，订单付款后一个月内开具，点击“我的订单”查看和下载', '好的,我知道了', '', 'init()', '', null);
	
			
		}
		 function init(){
		 
		 	orderId = api.pageParam.orderId;
			organizationType = api.pageParam.organizationType;
			is_personal = '0';

			//发票抬头切换时改变div
			$("input[name=2]").click(function() {
				var name = $(this).attr("id");
				
				if (name == 'is_personal') {

					$('#unit').attr("style", "display:none;");
					$('#unit1').attr("style", "display:block;");
					is_personal = '0';
					ein = $('.inputs').val("");
					entity_name = $('.entity_name').val("");
				} else {
					$('#unit1').attr("style", "display:none;");
					$('#unit').attr("style", "display:block;");
					name = $('.name').val("");
					is_personal = '1';
				}
			});
			//软键盘弹出时隐藏确定按钮，调整页面
			if (systemType == 'ios') {
				$('.input').bind('focus', function() {
					$('#footer').css('position', 'static');
					
				}).bind('blur', function() {
					$('#footer').css({
						'position': 'fixed',
						'bottom': '0'
					});
					
				});

			} else {
				var winHeight = $(window).height(); //获取当前页面高度
				$(window).resize(function() {
					var thisHeight = $(this).height();
					if (winHeight - thisHeight > 100) {
						$('#footer').css('position', 'static'); //键盘弹出
						
						if ($(".email").is(":focus")) {
							document.getElementById('email').scrollIntoView({
								block: "start",
								behavior: "smooth"
							});
						}
						if ($(".phone").is(":focus")) {
							document.getElementById('phone').scrollIntoView({
								block: "start",
								behavior: "smooth"
							});
						}
						if ($(".entity_name").is(":focus")) {
							document.getElementById('entity_name').scrollIntoView({
								block: "start",
								behavior: "smooth"
							});
						}
						
						if ($(".name").is(":focus")) {
							document.getElementById('name').scrollIntoView({
								block: "start",
								behavior: "smooth"
							});
						}
						if ($(".inputs").is(":focus")) {
							document.getElementById('input').scrollIntoView({
								block: "start",
								behavior: "smooth"
							});
						}
					} else {
						$('#footer').css({
							'position': 'fixed',
							'bottom': '0'
						}); //键盘收起

					}
				})

			}
		 
		 }
	
      
		//按确定按钮，保存信息
		function closeFrm() {
			var title;
			name = $('.name').val();
			phone = $('.phone').val();
			mail = $('.email').val();
			ein = $('.inputs').val();
			entity_name = $('.entity_name').val();
			if ((ein != '' && entity_name != '') || name != '' && phone != '' && mail != '') {
				if (isPhoneAvailable(phone)) {
					 defaultload('提交申请中');
					 putInvoice();
							
				} else {
					alert('请输入正确的手机号');
				}
				
			
			} else {

				if (is_personal == '0') {
					if (name == '') {
						title = '姓名不能为空！'
					}
				} else {
					if (ein == '') {
						title = '单位税号不能为空！'
					}
					if (entity_name == '') {
						title = '单位名称不能为空！'
					}

				}
				if (phone == '') {
					title = '电话不能为空！'
				}
				if (mail == '') {
					title = '邮箱不能为空！'
				}

				alert(title);
			}



		}
		function putInvoice(){
			if(cache.organizationType =='0'){
				params = {
					organizationType:'0',
					orderId:cache.ordId,
					testCenterId:cache.testCenterId,
					is_personal: is_personal,
					name: name,
					phone: phone,
					mail: mail,
					ein: ein,
					entity_name: entity_name,
					isVip: cache.isVip,
					kemu:cache.kemu,
					useWay:'0',//报名用途，写死
					invoiceType:'0',//开票类型
				}
			}
			if(cache.organizationType=='1'){
				params = {
					organizationType:'1',
					orderId:cache.ordId,
					hospitalId:cache.hospitalId,
					is_personal: is_personal,
					name: name,
					phone: phone,
					mail: mail,
					ein: ein,
					entity_name: entity_name,
					useWay:'0',//报名用途，写死
					invoiceType:'0',//开票类型
				}
			}
			if(cache.organizationType=='2'){
				params = {
					organizationType:'2',
					orderId:cache.ordId,
					schoolId:cache.schoolId,
					is_personal: is_personal,
					name: name,
					phone: phone,
					mail: mail,
					ein: ein,
					entity_name: entity_name,
					useWay:'0',//报名用途，写死
					invoiceType:'0',//开票类型
				}
			}
			url='/api/invoices/saveInvoiceInfo'
			log('params:::',params)
			ajax_Request(url, 'post', 'json', params, function(ret, err) {
				log('ret::::::',ret);
				api.hideProgress();
				if(ret){
					if(ret.code == 0){
						alert_msg('提交申请成功');
						api.sendEvent({
						    name: 'closeWinInv',
						    extra: {
						        key1: '1',
						    }
						});
						setTimeout(function(){
							api.closeWin();
						},1000);
		            }
	            }else{
	            	alert_msg('服务器繁忙，请稍后重试');
	            }
			});
		}
	</script>
</html>
